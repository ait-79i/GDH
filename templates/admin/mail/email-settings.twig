<div class="wrap gdhrdv-email-settings">
	<h1>Paramètres des e-mails</h1>

	{% if show_saved_notice %}
		<div class="notice notice-success is-dismissible">
			<p>Paramètres e-mail enregistrés.</p>
		</div>
	{% endif %}

	<form method="post" action="{{ form_action }}">
		{{ settings_fields_html|raw }}

		<!-- Section 1: Configuration des destinataires -->
		<div class="postbox">
			<div class="postbox-header">
				<h2 class="hndle">Configuration des destinataires</h2>
			</div>
			<div class="inside">
				<div class="gdhrdv-recipients-grid">
					<div class="gdhrdv-recipient-option">
						<h3>Destinataire statique</h3>
						<p class="description">Email fixe pour toutes les demandes</p>
						<label for="gdhrdv_recv_mode_static" class="gdhrdv-label">
							<input type="radio" id="gdhrdv_recv_mode_static" name="receiver_mode" value="static" {% if recv_mode == 'static' %} checked {% endif %}>
							Activer ce mode
						</label>
						<div id="gdhrdv_recv_static_wrap" class="gdhrdv-fields-wrap {% if recv_mode != 'static' %}gdhrdv-muted{% endif %}">
							<div id="gdhrdv_recv_static_block" class="{% if recv_mode != 'static' %}gdhrdv-pe-none{% endif %}">
								<div class="gdhrdv-field">
									<label for="receiver_static_email">E-mail</label>
									<input type="email" id="receiver_static_email" name="gdhrdv_receivers[static][email]" class="regular-text" value="{{ recv_static_email|e }}" {% if recv_mode != 'static' %} disabled {% endif %}>
								</div>
								<div class="gdhrdv-field">
									<label for="receiver_static_name">Nom</label>
									<input type="text" id="receiver_static_name" name="gdhrdv_receivers[static][name]" class="regular-text" value="{{ recv_static_name|e }}" {% if recv_mode != 'static' %} disabled {% endif %}>
								</div>
							</div>
						</div>
					</div>
					<div class="gdhrdv-recipient-option">
						<h3>Destinataire dynamique</h3>
						<p class="description">Email récupéré depuis les meta du post courant</p>
						<label for="gdhrdv_recv_mode_dynamic" class="gdhrdv-label">
							<input type="radio" id="gdhrdv_recv_mode_dynamic" name="receiver_mode" value="dynamic" {% if recv_mode == 'dynamic' %} checked {% endif %}>
							Activer ce mode
						</label>
						<div id="gdhrdv_recv_dyn_wrap" class="gdhrdv-fields-wrap {% if recv_mode != 'dynamic' %}gdhrdv-muted{% endif %}">
							<div id="gdhrdv_recv_dyn_block" class="{% if recv_mode != 'dynamic' %}gdhrdv-pe-none{% endif %}">
								<div class="gdhrdv-field">
									<label for="receiver_dynamic_post_type">Type de contenu</label>
									<select id="receiver_dynamic_post_type" name="gdhrdv_receivers[dynamic][post_type]" {% if recv_mode != 'dynamic' %} disabled {% endif %}>
										<option value="">— Sélectionner —</option>
										{% for key, label in all_post_types %}
											<option value="{{ key|e }}" {% if recv_dyn_post_type == key %} selected {% endif %}>{{ label }}</option>
										{% endfor %}
									</select>
								</div>
								<div class="gdhrdv-field">
									<label for="receiver_dynamic_email">Meta key email</label>
									<select id="receiver_dynamic_email" name="gdhrdv_receivers[dynamic][email]" data-selected="{{ recv_dyn_email|e }}" {% if recv_mode != 'dynamic' %} disabled {% endif %}>
										<option value="">— Sélectionner une meta —</option>
									</select>
								</div>
								<div class="gdhrdv-field">
									<label for="receiver_dynamic_name">Meta key nom</label>
									<select id="receiver_dynamic_name" name="gdhrdv_receivers[dynamic][name]" data-selected="{{ recv_dyn_name|e }}" {% if recv_mode != 'dynamic' %} disabled {% endif %}>
										<option value="">— Sélectionner une meta —</option>
									</select>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>

		<!-- Section 2: Templates d'emails -->
		<div class="postbox">
			<div class="postbox-header">
				<h2 class="hndle">Templates d'emails</h2>
			</div>
			<div class="inside">
				<div class="gdhrdv-templates-grid">
					<div class="gdhrdv-template-section">
						{% include 'admin/mail/partials/artisan-mail.twig' %}
					</div>
					<div class="gdhrdv-template-section">
						{% include 'admin/mail/partials/confirmation-mail.twig' %}
					</div>
				</div>
			</div>
		</div>

		<p class="submit">
			<button type="submit" class="button button-primary">Enregistrer les paramètres</button>
		</p>
	</form>
</div>
